{
  "query": "\n-- 添加users表缺失的字段\nALTER TABLE users ADD COLUMN IF NOT EXISTS resetToken VARCHAR(100);\nALTER TABLE users ADD COLUMN IF NOT EXISTS resetTokenExpires TIMESTAMP NULL;\nALTER TABLE users ADD COLUMN IF NOT EXISTS currentDeviceId VARCHAR(100);\nALTER TABLE users ADD COLUMN IF NOT EXISTS currentDeviceLoginAt TIMESTAMP NULL;\n\n-- 创建system_configs表\nCREATE TABLE IF NOT EXISTS system_configs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  `key` VARCHAR(100) NOT NULL UNIQUE,\n  value TEXT NOT NULL,\n  description TEXT,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  updatedBy VARCHAR(50)\n);\n\n-- 创建recharge_orders表\nCREATE TABLE IF NOT EXISTS recharge_orders (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  orderId VARCHAR(32) NOT NULL UNIQUE,\n  userId INT NOT NULL,\n  credits INT NOT NULL,\n  amount DECIMAL(10, 2) NOT NULL,\n  walletAddress VARCHAR(100) NOT NULL,\n  network VARCHAR(20) DEFAULT 'TRC20' NOT NULL,\n  status ENUM('pending', 'paid', 'cancelled', 'expired', 'mismatch') DEFAULT 'pending' NOT NULL,\n  txId VARCHAR(100),\n  receivedAmount DECIMAL(10, 2),\n  adminNote TEXT,\n  expiresAt TIMESTAMP NOT NULL,\n  paidAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建search_tasks表\nCREATE TABLE IF NOT EXISTS search_tasks (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  taskId VARCHAR(32) NOT NULL UNIQUE,\n  userId INT NOT NULL,\n  searchHash VARCHAR(32) NOT NULL,\n  params JSON NOT NULL,\n  requestedCount INT NOT NULL,\n  actualCount INT DEFAULT 0,\n  creditsUsed INT DEFAULT 0,\n  status ENUM('pending', 'running', 'completed', 'failed') DEFAULT 'pending' NOT NULL,\n  progress INT DEFAULT 0,\n  logs JSON,\n  errorMessage TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  completedAt TIMESTAMP NULL\n);\n\n-- 创建search_results表\nCREATE TABLE IF NOT EXISTS search_results (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  taskId INT NOT NULL,\n  apolloId VARCHAR(64) NOT NULL,\n  data JSON NOT NULL,\n  verified BOOLEAN DEFAULT FALSE,\n  verificationScore INT,\n  verificationDetails JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建global_cache表\nCREATE TABLE IF NOT EXISTS global_cache (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  apolloId VARCHAR(64) NOT NULL UNIQUE,\n  data JSON NOT NULL,\n  phoneNumber VARCHAR(20),\n  verified BOOLEAN DEFAULT FALSE,\n  verificationScore INT,\n  verificationDetails JSON,\n  hitCount INT DEFAULT 1,\n  lastHitAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  expiresAt TIMESTAMP NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建search_logs表\nCREATE TABLE IF NOT EXISTS search_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  taskId INT,\n  action VARCHAR(50) NOT NULL,\n  creditsUsed INT DEFAULT 0,\n  details JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建credit_logs表\nCREATE TABLE IF NOT EXISTS credit_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  amount INT NOT NULL,\n  balanceAfter INT NOT NULL,\n  type ENUM('recharge', 'search', 'refund', 'admin_adjust', 'bonus') NOT NULL,\n  referenceId VARCHAR(50),\n  description TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建admin_logs表\nCREATE TABLE IF NOT EXISTS admin_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  adminId INT NOT NULL,\n  action VARCHAR(100) NOT NULL,\n  targetType VARCHAR(50),\n  targetId VARCHAR(50),\n  details JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建login_logs表\nCREATE TABLE IF NOT EXISTS login_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  deviceId VARCHAR(100) NOT NULL,\n  userAgent TEXT,\n  ipAddress VARCHAR(45),\n  success BOOLEAN DEFAULT TRUE,\n  failReason TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建api_logs表\nCREATE TABLE IF NOT EXISTS api_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  endpoint VARCHAR(100) NOT NULL,\n  method VARCHAR(10) NOT NULL,\n  requestBody JSON,\n  responseStatus INT,\n  responseTime INT,\n  errorMessage TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 45EeJhNykDRAg24.root --database QJRJWxFrojkody2y2qTtrX --execute \n-- 添加users表缺失的字段\nALTER TABLE users ADD COLUMN IF NOT EXISTS resetToken VARCHAR(100);\nALTER TABLE users ADD COLUMN IF NOT EXISTS resetTokenExpires TIMESTAMP NULL;\nALTER TABLE users ADD COLUMN IF NOT EXISTS currentDeviceId VARCHAR(100);\nALTER TABLE users ADD COLUMN IF NOT EXISTS currentDeviceLoginAt TIMESTAMP NULL;\n\n-- 创建system_configs表\nCREATE TABLE IF NOT EXISTS system_configs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  `key` VARCHAR(100) NOT NULL UNIQUE,\n  value TEXT NOT NULL,\n  description TEXT,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  updatedBy VARCHAR(50)\n);\n\n-- 创建recharge_orders表\nCREATE TABLE IF NOT EXISTS recharge_orders (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  orderId VARCHAR(32) NOT NULL UNIQUE,\n  userId INT NOT NULL,\n  credits INT NOT NULL,\n  amount DECIMAL(10, 2) NOT NULL,\n  walletAddress VARCHAR(100) NOT NULL,\n  network VARCHAR(20) DEFAULT 'TRC20' NOT NULL,\n  status ENUM('pending', 'paid', 'cancelled', 'expired', 'mismatch') DEFAULT 'pending' NOT NULL,\n  txId VARCHAR(100),\n  receivedAmount DECIMAL(10, 2),\n  adminNote TEXT,\n  expiresAt TIMESTAMP NOT NULL,\n  paidAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建search_tasks表\nCREATE TABLE IF NOT EXISTS search_tasks (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  taskId VARCHAR(32) NOT NULL UNIQUE,\n  userId INT NOT NULL,\n  searchHash VARCHAR(32) NOT NULL,\n  params JSON NOT NULL,\n  requestedCount INT NOT NULL,\n  actualCount INT DEFAULT 0,\n  creditsUsed INT DEFAULT 0,\n  status ENUM('pending', 'running', 'completed', 'failed') DEFAULT 'pending' NOT NULL,\n  progress INT DEFAULT 0,\n  logs JSON,\n  errorMessage TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  completedAt TIMESTAMP NULL\n);\n\n-- 创建search_results表\nCREATE TABLE IF NOT EXISTS search_results (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  taskId INT NOT NULL,\n  apolloId VARCHAR(64) NOT NULL,\n  data JSON NOT NULL,\n  verified BOOLEAN DEFAULT FALSE,\n  verificationScore INT,\n  verificationDetails JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建global_cache表\nCREATE TABLE IF NOT EXISTS global_cache (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  apolloId VARCHAR(64) NOT NULL UNIQUE,\n  data JSON NOT NULL,\n  phoneNumber VARCHAR(20),\n  verified BOOLEAN DEFAULT FALSE,\n  verificationScore INT,\n  verificationDetails JSON,\n  hitCount INT DEFAULT 1,\n  lastHitAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  expiresAt TIMESTAMP NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建search_logs表\nCREATE TABLE IF NOT EXISTS search_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  taskId INT,\n  action VARCHAR(50) NOT NULL,\n  creditsUsed INT DEFAULT 0,\n  details JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建credit_logs表\nCREATE TABLE IF NOT EXISTS credit_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  amount INT NOT NULL,\n  balanceAfter INT NOT NULL,\n  type ENUM('recharge', 'search', 'refund', 'admin_adjust', 'bonus') NOT NULL,\n  referenceId VARCHAR(50),\n  description TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建admin_logs表\nCREATE TABLE IF NOT EXISTS admin_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  adminId INT NOT NULL,\n  action VARCHAR(100) NOT NULL,\n  targetType VARCHAR(50),\n  targetId VARCHAR(50),\n  details JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建login_logs表\nCREATE TABLE IF NOT EXISTS login_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  deviceId VARCHAR(100) NOT NULL,\n  userAgent TEXT,\n  ipAddress VARCHAR(45),\n  success BOOLEAN DEFAULT TRUE,\n  failReason TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 创建api_logs表\nCREATE TABLE IF NOT EXISTS api_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  endpoint VARCHAR(100) NOT NULL,\n  method VARCHAR(10) NOT NULL,\n  requestBody JSON,\n  responseStatus INT,\n  responseTime INT,\n  errorMessage TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 6900
}